!function(t,e,n){t.Template=t.Class.extend({_TAG_REGEX:/\(\(([a-z]+)::([^\)^\)]*)\)\)/,_TEST_HTML_REGEX:/(<[a-z][\s\S]*>(?=<\/[a-z][\s\S]*>)|<[a-z ][\s\S]*\/>)/,_PARAM_SEPARATOR:" ",_PARAM_STRING_DELIMITER:"'",_DEFAULTS:{html:null},_options:null,_canvas:null,init:function(t){this._canvas=n("div"),this._setOptions(t)},render:function(t,e){return"object"!=typeof t||t instanceof Array||(e=t,t=void 0),e&&this._setOptions(e),t=t||this._options.html,this._canvas.innerHTML="function"==typeof t.join?t.join(""):t,this._process(this._canvas.childNodes)},_callFunction:function(e,n,s){return void 0===t.Template._functions[e]?(console.warn("Template | Function '"+e+"' not found"),"<unknown function "+e+">"):t.Template._functions[e](n,s,this)},_processAttributes:function(t){for(var e=t.attributes,n=0,s=e.length;n<s;++n)this._TAG_REGEX.test(e[n].value)&&(e[n].value=this._parseText(t,e[n].value))},_process:function(t){for(var e=0,n=t.length;e<n;++e){var s=t[e];3===s.nodeType?this._processTextNode(s):("function"==typeof this["_processNode_"+s.nodeName]&&this["_processNode_"+s.nodeName](s),s.attributes.length&&this._processAttributes(s),s.childNodes.length&&this._process(s.childNodes))}return t},_parseParams:function(t){for(var e=t.split(this._PARAM_SEPARATOR),n=0,s=e.length;n<s;++n){var i=e[n].substr(0,1)===this._PARAM_STRING_DELIMITER&&e[n].substr(-1,1)===this._PARAM_STRING_DELIMITER?"string":"token";e[n]={type:i,value:"string"===i?e[n].trim(this._PARAM_STRING_DELIMITER):e[n]}}return e},_processNode_INPUT:function(t){t.attributes.value&&""!==t.attributes.value&&(t.attributes.value.value=this._parseText(t,t.attributes.value.value))},_processTextNode:function(t){var e=this._parseText(t,t.nodeValue);if(this._TEST_HTML_REGEX.test(e)){var s=n("DIV");s.innerHTML=e,t.parentNode.replaceChild(s,t)}else t.nodeValue=e},_parseText:function(t,e){for(var n;n=this._TAG_REGEX.exec(e);)e=e.substr(0,n.index)+this._callFunction(n[1],t,this._parseParams(n[2]))+e.substr(n.index+n[0].length);return e},_setOptions:function(t){this._options=e.extend({},this._options||this._DEFAULTS,t)}}),t.Template._functions=Object.create(null),t.Template.registerFunction=function(e,n){if(void 0!==t.Template._functions[e])throw new Error("Template | Function '"+e+"' already exist");t.Template._functions[e]=n},t.Template.create=function(e){return new t.Template(e)}}(HeO2_legacy,$,function(t){return document.createElement(t)}),function(t,e){t.Template.registerFunction("lang",function(t,n){return n&&n[0]&&n[0].value&&n[0].type?"token"===n[0].type?e.i18n(n[0].value):"string"===n[0].type?n[0].value:"<unknown type>":"<unknown tag>"})}(HeO2_legacy,$),function(t,e){function n(t){for(var n=Object.create(null),s=0,r=t.length;s<r;++s)if("token"===t[s].type){var a=t[s].value.split(i);n[a[0]]=a[1].substr(0,1)===o&&a[1].substr(-1,1)===o?a[1].trim(o):e.i18n(a[1])}return n}function s(t,e,n){void 0===r[e]&&(r[e]=[]),r[e].push({node:t,states:n})}var i="|",o="'",r=Object.create(null);t.Template.registerFunction("state",function(t,e){var i=e[0].value,o=n(e.splice(1));return s(t,i,o),o[Object.keys(o)[0]]}),t.Template.prototype.state=function(t,e){if(void 0!==r[t])for(var n=0,s=r[t].length;n<s;++n)r[t][n].states[e]&&(r[t][n].node.nodeValue=r[t][n].states[e]);else console.warn("Template/state | No saved states with id '"+t+"'")}}(HeO2_legacy,jQuery),function(t,e){t.Template.registerFunction("var",function(t,e,n){if(!n._options.callbacks&&"function"!=typeof n._options.callbacks.varMapper)throw new Error("Template/var | No variable mapper set");return n._options.callbacks.varMapper(e[0])})}(HeO2_legacy,jQuery);
